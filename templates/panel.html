<!DOCTYPE html>
<html>
<head>
  <title>HB Music â€¢ Painel</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<h2>Servidor {{ guild_id }}</h2>

<div class="player">
  <div id="track">Nenhuma mÃºsica</div>

  <input type="range" id="progress" min="0">

  <label>ğŸ”Š Volume</label>
  <input type="range" id="volume" min="1" max="100">

  <div class="controls">
    <button onclick="send('pause')">â¸</button>
    <button onclick="send('resume')">â–¶ï¸</button>
    <button onclick="send('skip')">â­</button>
  </div>
</div>

<script>
const gid = "{{ guild_id }}"

function send(action, value=null) {
  fetch("/api/control", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({guild: gid, action, value})
  })
}

function update() {
  fetch(`/api/state/${gid}`)
    .then(r => r.json())
    .then(d => {
      if (!d.track) return
      document.getElementById("track").innerText = d.track
      document.getElementById("progress").max = Math.floor(d.duration / 1000)
      document.getElementById("progress").value = d.position || 0
      document.getElementById("volume").value = d.volume || 50
    })
}

document.getElementById("progress").addEventListener("change", e => {
  send("seek", e.target.value)
})

document.getElementById("volume").addEventListener("change", e => {
  send("volume", e.target.value)
})

setInterval(update, 2000)
</script>

</body>
</html>
